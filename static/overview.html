<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interacting Entities</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="utils.js"></script>
</head>
<style>
    .container {
        width: 33%;
        float: left;
    }
    li {
        font-size: small;
    }
</style>
<body>
    <h4><a href="/static/viz.html">Enter query directly</a></h4>
    <h1>Overview of entities interacting with IL-6 (uniprot:P05231)</h1>
    <label for="order">Order by:</label> <select name="order" id="order">
        <option value="weight">Custom Weight</option>
        <option value="freq">Frequency</option>
        <option value="name">Name</option>
        <option value="gid">Database I.D.</option>
    </select>
    <label>Filter by:</label> <input type="text" id="filter" onkeyup="filter(this)">
    <div style="width: 100%">
        <div id="influenced" class="container">
            <h3>Influenced by:</h3>
            <ul />
        </div>
        <div id="reciprocal" class="container">
            <h3>Reciprocal with:</h3>
            <ul />
        </div>
        <div id="influencers" class="container">
            <h3>Influence:</h3>
            <ul />
        </div>
    </div>
    <script>
        var data = Array()

        function populateList() {
           let influenced = data.influenced
           let influencers = data.influencers
           let reciprocals = data.reciprocals

           const orderControl = $("#order")
            const orderCriteria = orderControl.val()

            if(orderCriteria === 'freq')
                elementIx = 2
            else if(orderCriteria === "name")
                elementIx = 1
            else if(orderCriteria === "weight")
                elementIx = 3
            else
                elementIx = 0

           influenced.sort((a, b) => a[elementIx] < b[elementIx] ? 1 : -1)
           reciprocals.sort((a, b) => a[elementIx] < b[elementIx] ? 1 : -1)
           influencers.sort((a, b) => a[elementIx] < b[elementIx] ? 1 : -1)

            $("#influenced ul").empty()
           influenced.forEach(
               elem => {
                   const id = elem[0]
                   const label = elem[1]
                   const freq = elem[2]
                   const weight = elem[3]

                   $("#influenced ul").append(`<li><a href="/static/viz.html?src=IL6 (uniprot:P05231)&dst=${label} (${id})">${label} (${id})</a> - F: ${freq} - W: ${weight.toFixed(2)}</li>`)
               }
           )

            $("#influencers ul").empty()
           influencers.forEach(
               elem => {
                   const id = elem[0]
                   const label = elem[1]
                   const freq = elem[2]
                   const weight = elem[3]

                   const w =

                   $("#influencers ul").append(`<li><a href="/static/viz.html?dst=IL6 (uniprot:P05231)&src=${label} (${id})">${label} (${id})</a> - F: ${freq} - W: ${weight.toFixed(2)}</li>`)
               }
           )

            $("#reciprocal ul").empty()
           reciprocals.forEach(
               elem => {
                   const id = elem[0]
                   const label = elem[1]
                   const freq = elem[2]
                   const weight = elem[3]

                   $("#reciprocal ul").append(`<li><a href="/static/viz.html?dst=IL6 (uniprot:P05231)&src=${label} (${id})&bidirect">${label} (${id})</a> - F: ${freq} - W: ${weight.toFixed(2)}</li>`)
               }
           )
       }

       function weight_result(data){
            let influenced = data.influenced
            let influencers = data.influencers
            let reciprocals = data.reciprocals

           function helper(elems){
                elems.forEach(elem => {
                   elem[3]['freq'] = elem[2]
                })

                elems.forEach(elem => {
                    const w = arizona_weight(elem[3])
                    elem[3] = w
                })
           }

           helper(influenced)
           helper(influencers)
           helper(reciprocals)

       }

        $.getJSON(`/overview/uniprot:P05231/`,
          result => {
              data = result
              weight_result(data)
              populateList();
          }
        )

        document.querySelector('#order').addEventListener('change', populateList);
        function filter(element) {
        var value = $(element).val().toLowerCase();

        $("ul > li").each(function() {
            if ($(this).text().toLowerCase().search(value) > -1) {
                $(this).show();
            }
            else {
                $(this).hide();
            }
        });
    }
    </script>
</body>
</html>